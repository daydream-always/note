# 26 乘客端登录-微信小程序登录接口（准备工作）

2025年 12月 09日 星期二 10:52:43 CST

![image-20251209105348533](C:\Users\92503\AppData\Roaming\Typora\typora-user-images\image-20251209105348533.png)

service-client：远程调用接口的定义



- 引入微信工具包相关依赖

在service-customer里面引入依赖

```xml
<dependencies>
    <dependency>
        <groupId>com.github.binarywang</groupId>
        <artifactId>weixin-java-miniapp</artifactId>
    </dependency>
</dependencies>
```

* 修改Nacos配置中心配置文件

在项目配置文件进行修改bootstrap.properties

```properties
spring.application.name=service-customer
spring.profiles.active=dev
spring.main.allow-bean-definition-overriding=true
spring.cloud.nacos.discovery.server-addr=192.168.6.129:8848
spring.cloud.nacos.config.server-addr=192.168.6.129:8848
spring.cloud.nacos.config.prefix=${spring.application.name}
spring.cloud.nacos.config.file-extension=yaml
spring.cloud.nacos.config.shared-configs[0].data-id=common-account.yaml
```

Nacos配置中心common-account.yaml

```yaml
wx:
  miniapp:
    appId: 你的微信小程序id  # 小程序微信公众平台appId
    secret: 你的微信小程序id秘钥  # 小程序微信公众平台api秘钥
wx:
  miniapp:
    appId: wxf31a4473cf136420  # 小程序微信公众平台appId
    secret: 01a85d5d3a177fb69be2a8942d018286  # 小程序微信公众平台api秘钥
```

- 创建配置类，读取配置文件信息

在service-customer创建包config，创建类，读取配置文件内容

```Java
@Component
@Data
@ConfigurationProperties(prefix = "wx.miniapp")
public class WxConfigProperties {
    private String appId;
    private String secret;
}
```

@Component 注解的作用

用于将 WxConfigProperties 类标记为Spring容器管理的组件(Bean)

配合Spring的组件扫描机制，使得该配置类能够被自动发现并注册到Spring应用上下文中

允许其他类通过 @Autowired 等注解直接注入和使用 WxConfigProperties 实例

@ConfigurationProperties 注解的作用

实现从配置文件(如application.yml)自动绑定 wx.miniapp 前缀的属性值到该Bean的字段中。

Spring Boot 读取配置文件中 wx.miniapp 前缀的属性

自动将 wx.miniapp.app-id 的值 "wx1234567890abcdef" 赋给 appId 字段

自动将 wx.miniapp.secret 的值 "abcdefghijklmnopqrstuvwxyz" 赋给 secret 字段

通过驼峰命名规则自动转换 - 分隔的属性名到驼峰式字段名（即映射到驼峰格式的属性上）

这样就实现了配置文件与 Java 对象的自动绑定，无需手动读取和赋值。



- 创建微信工具包对象

```Java
@Component
public class WxConfigOperator {

    @Autowired
    private WxConfigProperties wxConfigProperties;

    @Bean
    public WxMaService wxMaService() {
        //微信小程序id和秘钥
        WxMaDefaultConfigImpl wxMaConfig = new WxMaDefaultConfigImpl();
        wxMaConfig.setAppid(wxConfigProperties.getAppId());
        wxMaConfig.setSecret(wxConfigProperties.getSecret());

        WxMaService service = new WxMaServiceImpl();
        service.setWxMaConfig(wxMaConfig);
        return service;
    }
}
```

@Autowired
private WxConfigProperties wxConfigProperties;

WxMaDefaultConfigImpl wxMaConfig = new WxMaDefaultConfigImpl();

wxMaConfig.setAppid(wxConfigProperties.getAppId());

wxMaConfig.setSecret(wxConfigProperties.getSecret());

 WxMaService service = new WxMaServiceImpl();

service.setWxMaConfig(wxMaConfig);



new WxMaDefaultConfigImpl()——wxMaConfig

new WxMaServiceImpl();——service

service.setWxMaConfig(wxMaConfig);



使用 @Bean 注解定义 wxMaService() 方法，创建并配置 WxMaService 微信小程序服务实例

将配置好的 WxMaService 实例注册为Spring Bean，供其他组件使用

这样其他组件就可以直接通过 @Autowired 注入 WxMaSe	rvice 来调用微信小程序的相关API功能。



2025年 12月 09日 星期二 11:42:04 CST
