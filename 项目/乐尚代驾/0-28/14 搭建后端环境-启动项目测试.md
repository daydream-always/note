# 14 搭建后端环境-启动项目测试

bootstrap.properties 通常出现在 Spring Boot 或 Spring Cloud 项目中，

是用来配置应用启动时的一些基础属性的文件。

它和 application.properties 很相似，但用途略有不同。



- **以server-gateway为例，测试项目是否正常启动**

修改server-gateway模块配置文件

bootstrap.properties文件修改实际Nacos地址

```properties
spring.application.name=server-gateway
spring.profiles.active=dev
spring.main.allow-bean-definition-overriding=true
spring.cloud.nacos.discovery.server-addr=192.168.157.101:8848
spring.cloud.nacos.config.server-addr=192.168.157.101:8848
spring.cloud.nacos.config.prefix=${spring.application.name}
spring.cloud.nacos.config.file-extension=yaml
```

找到Nacos配置中心对应配置文件yaml，进行修改

```yaml
server:
  port: 8600
feign:
  sentinel:
    enabled: true
spring:
  cloud:
    openfeign:
      lazy-attributes-resolution: true
      client:
        config:
          default:
            connectTimeout: 30000
            readTimeout: 30000
            loggerLevel: basic
    gateway:
      discovery:      #是否与服务发现组件进行结合，通过 serviceId(必须设置成大写) 转发到具体的服务实例。默认为false，设为true便开启通过服务中心的自动根据 serviceId 创建路由的功能。
        locator:      #路由访问方式：http://Gateway_HOST:Gateway_PORT/大写的serviceId/**，其中微服务应用名默认大写访问。
          enabled: true
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOriginPatterns: "*"
            # 允许请求中携带的头信息
            allowedHeaders: "*"
            # 运行跨域的请求方式
            allowedMethods: "*"
            # 跨域检测的有效期,单位s
            maxAge: 36000
      routes:
        # web 接口
        - id: web-customer
          uri: lb://web-customer
          predicates:
            - Path=/customer-api/**
          filters:
            - StripPrefix=1
        - id: web-driver
          uri: lb://web-driver
          predicates:
            - Path=/driver-api/**
          filters:
            - StripPrefix=1
        - id: web-mgr
          uri: lb://web-mgr
          predicates:
            - Path=/mgr-api/**
          filters:
            - StripPrefix=1
        - id: service-payment
          uri: lb://service-payment
          predicates:
            - Path=/payment/**

```

启动server-gateway服务进行测试

网关服务已经在nacos注册，如下

![image-20251206123600131](C:\Users\92503\AppData\Roaming\Typora\typora-user-images\image-20251206123600131.png)



- **以service-coupon为例，测试项目是否正常启动**（优惠卷）

修改service-coupon模块配置文件

bootstrap.properties文件修改实际Nacos地址

```properties
spring.application.name=service-coupon
spring.profiles.active=dev
spring.main.allow-bean-definition-overriding=true
spring.cloud.nacos.discovery.server-addr=192.168.157.101:8848
spring.cloud.nacos.config.server-addr=192.168.157.101:8848
spring.cloud.nacos.config.prefix=${spring.application.name}
spring.cloud.nacos.config.file-extension=yaml
spring.cloud.nacos.config.shared-configs[0].data-id=common-account.yaml
# Nacos 认证用户名
spring.cloud.nacos.config.username=nacos
# Nacos 认证密码
spring.cloud.nacos.config.password=nacos
# 服务发现认证信息
spring.cloud.nacos.discovery.username=nacos
spring.cloud.nacos.discovery.password=nacos

核心问题是 Nacos 开启了认证，应用缺少用户名密码配置导致 403 错误。
解决关键是在应用的 bootstrap.yml/properties 中配置正确的 Nacos 用户名和密码。
生产环境务必开启 Nacos 认证，并使用非默认的强密码。
```

找到Nacos配置中心对应配置文件yaml，进行修改

```yaml
server:
  port: 8511
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 查看日志
feign:
  sentinel:
    enabled: true
spring:
  main:
    allow-bean-definition-overriding: true #当遇到同样名字的时候，是否允许覆盖注册
  cloud:
    openfeign:
      lazy-attributes-resolution: true #开启懒加载，否则启动报错
      client:
        config:
          default:
            connectTimeout: 30000
            readTimeout: 30000
            loggerLevel: basic
  data:
    redis:
      host: 192.168.157.101
      port: 6380
      database: 0
      timeout: 1800000
      password: 123456
      jedis:
        pool:
          max-active: 20 #最大连接数
          max-wait: -1    #最大阻塞等待时间(负数表示没限制)
          max-idle: 5    #最大空闲
          min-idle: 0     #最小空闲
  rabbitmq:
    host: 192.168.157.101
    port: 5672
    username: guest
    password: guest
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://192.168.157.101:3307/daijia_coupon?characterEncoding=utf-8&useSSL=false
    username: root
    password: root
    hikari:
      connection-test-query: SELECT 1
      connection-timeout: 60000
      idle-timeout: 500000
      max-lifetime: 540000
      maximum-pool-size: 10
      minimum-idle: 5
      pool-name: GuliHikariPool
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8

```

启动service-coupon服务进行测试

```
2025-12-06T16:06:26.974+08:00 ERROR 21104 --- [           main] o.a.catalina.core.AprLifecycleListener   : 
An incompatible version [1.2.23] of the Apache Tomcat Native library is installed, while Tomcat requires version [1.2.34]

Loading class `com.mysql.jdbc.Driver'. 
This is deprecated. 
The new driver class is `com.mysql.cj.jdbc.Driver'. 
The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.

```

mysql容器安装的是8.0的，注意nacos配置文件里面DriverClassName加个c」

















