# 11 搭建后端环境-安装软件环境

linux终止命令的运行：Ctrl + C

- **安装mysql**

启动 MySQL 容器

```dockerfile
docker run -d \
--name gmalldocker_mysql \
-p 3307:3306 \
-v /data/mysql:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-e TZ=Asia/Shanghai \
--restart=always \
mysql:8.0.30

#主机端口改为3307，容器内仍为3306
#-v /data/mysql:/var/lib/mysql	数据卷挂载（将容器内的数据目录映射到主机，实现数据持久化）
```

2验证容器是否运行

```bush
docker ps | grep gmalldocker_mysql

docker ps
```

进入 MySQL 容器并登录

```dockerfile
# 进入容器内部连接 MySQL
docker exec -it gmalldocker_mysql mysql -uroot -p
# 或者通过主机端口连接（需要主机安装 mysql 客户端）
mysql -h 127.0.0.1 -uroot -p -P 3306
```



- **安装rabbitmq**

拉取镜像

docker pull rabbitmq:3.12.0-management

启动容器

docker run -d --name=rabbitmq --restart=always -p 5672:5672 -p 15672:15672 rabbitmq:3.12.0-management

查看容器

docker ps | grep rabbitmq 

延迟队列插件安装

https://www.rabbitmq.com/community-plugins.html

==》release发布

![image-20251205102822430](C:\Users\92503\AppData\Roaming\Typora\typora-user-images\image-20251205102822430.png)

==》asset

![image-20251205105843075](C:\Users\92503\AppData\Roaming\Typora\typora-user-images\image-20251205105843075.png)



首先下载rabbitmq_delayed_message_exchange-3.12.0.ez文件上传到RabbitMQ所在服务器

上传下载延迟队列插件到Linux操作系统中，切换到插件所在目录

执行 docker cp rabbitmq_delayed_message_exchange-3.12.0.ez rabbitmq:/plugins 命令，将插件拷贝到容器内plugins目录下

执行 docker exec -it rabbitmq /bin/bash 命令进入到容器内部

并 cd plugins 进入plugins目录

执行 ls -l|grep delay  命令查看插件是否copy成功

在容器内plugins目录下，执行 rabbitmq-plugins enable rabbitmq_delayed_message_exchange  命令启用插件

```dockerfile
[root@server01 ~]# docker cp rabbitmq_delayed_message_exchange-3.12.0.ez rabbitmq:/plugins
Successfully copied 50.2kB to rabbitmq:/opt/rabbitmq/plugins
[root@server01 ~]# docker exec -it rabbitmq /bin/bash
root@198a1455bcd5:/# cd plugins
root@198a1455bcd5:/plugins# ls -l|grep delay
-rw-r--r-- 1 root     root     48214 Dec  5 03:01 rabbitmq_delayed_message_exchange-3.12.0.ez
root@198a1455bcd5:/plugins# rabbitmq-plugins enable rabbitmq_delayed_message_exchange
Enabling plugins on node rabbit@198a1455bcd5:
rabbitmq_delayed_message_exchange
The following plugins have been configured:
  rabbitmq_delayed_message_exchange
  rabbitmq_management
  rabbitmq_management_agent
  rabbitmq_prometheus
  rabbitmq_web_dispatch
Applying plugin configuration to rabbit@198a1455bcd5...
The following plugins have been enabled:
  rabbitmq_delayed_message_exchange

started 1 plugins.
root@198a1455bcd5:/plugins#

```

exit命令退出RabbitMQ容器内部，然后执行 docker restart rabbitmq 命令重启RabbitMQ容器



* **安装Redis**

检查状态

systemctl status docker

systemctl start docker

systemctl enable docker

拉取 Redis 7.0 官方镜像

docker pull redis:7.0

```dockerfile
[root@server01 ~]# docker pull redis:7.0
7.0: Pulling from library/redis
a2318d6c47ec: Pull complete
b59068c7715f: Pull complete
96796a2514ff: Pull complete
b8c430d0189b: Pull complete
fcf1b4feeffd: Pull complete
bcec16c47e35: Pull complete
4f4fb700ef54: Pull complete
73586727588c: Pull complete
Digest: sha256:352c1fdadc91926edda08f45aeb3f27f37194c2f14101229c0523a11195c96e3
Status: Downloaded newer image for redis:7.0
docker.io/library/redis:7.0

```

查看已拉取的镜像

docker images

```bash
[root@server01 ~]# docker images
REPOSITORY   TAG                 IMAGE ID       CREATED         SIZE
redis        7.0                 7705dd2858c1   18 months ago   109MB
rabbitmq     3.12.0-management   fa6f2153e5c0   2 years ago     256MB
mysql        8.0.30              dbaea59d1b41   3 years ago     449MB

```

创建配置目录和数据目录

mkdir -p /usr/local/redis/conf /usr/local/redis/data

创建 Redis 配置文件（核心配置）

touch /usr/local/redis/conf/redis.conf

编辑配置文件（解决远程连接、持久化等问题）

vi /usr/local/redis/conf/redis.conf

```bash
# 允许远程连接（注释 bind 127.0.0.1）
bind 0.0.0.0
# 关闭保护模式
protected-mode no
# 设置密码（替换为你的密码，如 123456）
requirepass 123456
# 开启 RDB 持久化（默认开启，补充配置）
save 900 1
save 300 10
save 60 10000
# 持久化文件保存目录
dir /data
# 日志文件
logfile "/data/redis-server.log"
```

启动容器（挂载目录 + 配置）

```bash
docker run -d \
  --name myredis \
  -p 6380:6379 \
  -v /usr/local/redis/conf/redis.conf:/etc/redis/redis.conf \
  -v /usr/local/redis/data:/data \
  --restart=always \
  redis:7.0 \
  redis-server /etc/redis/redis.conf
  
#宿主机redis端口改成6380
#挂载时配置conf文件不能为空，但目录可空
-v：目录挂载（宿主机目录 → 容器目录）
--restart=always：容器随 Docker 启动而自动启动
redis-server /etc/redis/redis.conf：指定配置文件启动 Redis
```

查看容器状态（显示 Up 则正常）

docker ps | grep myredis

```dockerfile
[root@server01 ~]# docker ps | grep myredis
2f920d09caaa   redis:7.0                    
"docker-entrypoint.s…"   
About a minute ago   
Up About a minute   
0.0.0.0:6380->6379/tcp, :::6380->6379/tcp                                                                                                myredis
```

进入容器连接 Redis

docker exec -it myredis redis-cli

```
[root@server01 ~]# docker exec -it myredis redis-cli
127.0.0.1:6379>
```

验证密码（替换为你的密码）

127.0.0.1:6379> auth 

127.0.0.1:6379> auth 123456

```
127.0.0.1:6379> auth [username] password
127.0.0.1:6379> auth 123456 [username] password

127.0.0.1:6379> auth 123456
OK
```

测试写入数据

127.0.0.1:6379> set test "hello redis"

```
127.0.0.1:6379> set test "hello redis" [NX|XX] [GET] [EX seconds|PX milliseconds|EXAT unix-time-seconds|PXAT unix-time-milliseconds|KEEPT
127.0.0.1:6379> set test "hello redis"
OK
```

读取数据（返回 "hello redis" 则正常）

127.0.0.1:6379> get test

```
127.0.0.1:6379> get test
"hello redis"
```

启动/停止/重启容器

docker start myredis
docker stop myredis
docker restart myredis

查看 Redis 日志

docker logs -f myredis

删除容器（需先停止）

docker stop myredis && docker rm myredis



* **安装nacos**
* [安装nacos，带鉴权](#鉴权版)

检查 Docker 是否安装

docker --version

```dockerfile
[root@server01 ~]# docker --version
Docker version 26.1.4, build 5650f9b

```

检查 Docker 服务状态

systemctl status docker

拉取官方稳定版镜像（以 2.3.2 为例，可替换为最新版本）

docker pull nacos/nacos-server:v2.3.2

```
[root@server01 ~]# docker pull nacos/nacos-server:v2.3.2
v2.3.2: Pulling from nacos/nacos-server
Digest: sha256:d70b20546fe59aeb86add0754db1dbc3a3067363e18599329c5163d0d8cd9cd8
Status: Downloaded newer image for nacos/nacos-server:v2.3.2
docker.io/nacos/nacos-server:v2.3.2

```

创建 Nacos 配置和日志目录

mkdir -p /usr/local/nacos/conf /usr/local/nacos/logs
chmod -R 777 /usr/local/nacos

启动 Nacos 容器

```bash
docker run -d \
  --name nacos \
  --restart=always \
  -p 8848:8848 \
  -p 9848:9848 \
  -e MODE=standalone \
  -e PREFER_HOST_MODE=hostname \
  -v /usr/local/nacos/logs:/home/nacos/logs \
  nacos/nacos-server:v2.3.2
  
--name nacos：容器名称
--restart=always：Docker 重启时自动启动 Nacos
-p 8848:8848：映射 Nacos 主端口（访问控制台）
-p 9848:9848：Nacos 2.x 新增的 grpc 端口（必须映射）
-e MODE=standalone：单机模式运行（核心参数）
-v：挂载目录，实现配置 / 日志持久化（避免容器删除后数据丢失）
```

查看容器运行状态

docker ps | grep nacos

```
[root@server01 ~]# docker ps | grep nacos
5f8b45367dde   
nacos/nacos-server:v2.3.2    
"bin/docker-startup.…"   
22 seconds ago   Up 21 seconds   0.0.0.0:8848->8848/tcp, :::8848->8848/tcp, 0.0.0.0:9848->9848/tcp, :::9848->9848/tcp
```

查看 Nacos 日志（确认启动成功）

docker logs -f nacos

访问 Web 控制台：

浏览器打开 http://你的服务器IP:8848/nacos，默认账号 / 

密码：nacos/nacos

http://192.168.157.101:8848/nacos



* **安装minio**

拉取最新版 MinIO 镜像（推荐）

docker pull minio/minio:latest

创建本地数据目录（可自定义路径） 

mkdir -p /data/minio 

设置目录权限 

chmod -R 777 /data/minio

启动 MinIO 容器（配置 HTTPS 启动，先准备证书文件，再启动）

```bash
# 创建证书目录
mkdir -p /data/minio/certs
# 将你的证书文件（public.crt 和 private.key）放到该目录
# 启动容器
docker run -d \
  --name minio \
  --restart=always \
  -p 9002:9000 \
  -p 9003:9001 \
  -v /data/minio:/data \
  -v /data/minio/certs:/root/.minio/certs \
  -e "MINIO_ROOT_USER=admin" \
  -e "MINIO_ROOT_PASSWORD=Minio@123456" \
  minio/minio server /data --console-address ":9001"
  

-d	后台运行容器
--restart=always	容器异常退出时自动重启
-p 9002:9000	映射 MinIO API 端口（客户端访问用）
-p 9003:9001	映射 MinIO 控制台端口（网页访问用）
-v /data/minio:/data	挂载本地目录到容器内，实现数据持久化
.minio 中圆点的含义
在 Linux/Unix 系统中，文件名或目录名以 .（点）开头 表示这是一个隐藏文件 / 目录。系统默认不会在 ls 等命令中显示这类文件，通常用于存放程序的配置、缓存、证书等不希望用户误操作的内部数据。
MINIO_ROOT_USER MinIO 根用户名（自定义，建议复杂度高）
MINIO_ROOT_PASSWORD MinIO 根密码（必须至少 8 位，包含大小写 + 数字 + 特殊字符）
--console-address ":9001"	指定控制台端口，避免端口冲突（容器内）
```

检查 openssl 是否安装

openssl version

未安装则执行

yum install -y openssl

 生成证书和私钥

```
# 进入之前创建的证书目录
cd /data/minio/certs
# 生成私钥（private.key），按提示可直接回车跳过密码设置
openssl genrsa -out private.key 2048
# 生成证书请求文件（csr），按提示填写信息（至少填写 Common Name，如你的服务器IP或域名）
openssl req -new -key private.key -out minio.csr
```

```
Common Name (eg, your name or your server's hostname) []:192.168.157.101
Email Address []:
Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:123456
```

生成自签名证书（public.crt），有效期设为3650天（10年）

openssl x509 -req -days 3650 -in minio.csr -signkey private.key -out public.crt

```
[root@server01 certs]# openssl x509 -req -days 3650 -in minio.csr -signkey private.key -out public.crt
Signature ok
subject=/C=cn/ST=hainan/L=haikou/O=person/CN=192.168.157.101
Getting Private key
```

Common Name 必须填写你的 MinIO 访问地址（如服务器 IP：192.168.1.100 或域名：minio.example.com），否则访问时会提示证书不匹配；
生成后删除临时文件 minio.csr 不影响使用：rm -f minio.csr。



查看容器状态

docker ps | grep minio

```
[root@server01 certs]# docker ps | grep minio
bc32f0646340   
minio/minio                  "/usr/bin/docker-ent…"   
55 seconds ago   Up 54 seconds   0.0.0.0:9002->9000/tcp, :::9002->9000/tcp, 0.0.0.0:9003->9001/tcp, :::9003->9001/tcp                                                                  minio
```

查看容器日志

docker logs minio

访问 MinIO 控制台
在浏览器中访问：http://服务器IP:9001，输入你设置的用户名（admin）和密码（Minio@123456）即可登录。

https://192.168.157.101:9003/



所有镜像

![image-20251205184433169](C:\Users\92503\AppData\Roaming\Typora\typora-user-images\image-20251205184433169.png)













<a name="鉴权版"></a>

生成 Base64 密钥，开启鉴权需配置 Base64 编码的密钥（原始字符串长度≥32 位）

#示例原始密钥：ThisIsMyCustomSecretKeyForNacosAuth012345678

echo -n "ThisIsMyCustomSecretKeyForNacosAuth012345678" | base64

```bash
[root@server01 ~]#  echo -n "ThisIsMyCustomSecretKeyForNacosAuth012345678" | base64
VGhpc0lzTXlDdXN0b21TZWNyZXRLZXlGb3JOYWNvc0F1dGgwMTIzNDU2Nzg=
```

停止并删除旧容器

docker stop nacos && docker rm nacos

带鉴权参数启动新容器，通过环境变量开启鉴权（替换密钥等参数为你自定义的值）

```bash
docker run -d \
  --name nacos \
  --restart=always \
  -p 8848:8848 \
  -p 9848:9848 \
  -e MODE=standalone \
  -e PREFER_HOST_MODE=hostname \
  -e NACOS_AUTH_ENABLE=true \
  -e NACOS_AUTH_TOKEN=VGhpc0lzTXlDdXN0b21TZWNyZXRLZXlGb3JOYWNvc0F1dGgwMTIzNDU2Nzg= \
  -e NACOS_AUTH_IDENTITY_KEY=customKey \
  -e NACOS_AUTH_IDENTITY_VALUE=customValue \
  -v /usr/local/nacos/logs:/home/nacos/logs \
  nacos/nacos-server:v2.3.2
  
NACOS_AUTH_ENABLE=true 开启鉴权总开关
NACOS_AUTH_TOKEN 填入第一步生成的 Base64 密钥
NACOS_AUTH_IDENTITY_KEY/NACOS_AUTH_IDENTITY_VALUE 服务端身份识别的自定义密钥对，用于服务端间通信校验

```

如果你后续要搭建 Nacos 集群，所有节点的 NACOS_AUTH_IDENTITY_KEY 和 NACOS_AUTH_IDENTITY_VALUE 必须完全一致，否则集群节点间通信会失败；
单机模式下，即使随便填（比如 key123/value123），也不影响控制台登录和使用；
这两个参数和控制台登录的账号密码（nacos/nacos）无关，仅用于服务端内部校验。



验证鉴权效果

重新访问http://192.168.157.101:8848/nacos，此时会弹出登录框，输入默认账号密码nacos/nacos即可登录。登录后建议尽快通过控制台权限控制→用户管理修改默认密码，避免安全风险



































hhh<a name="跳转"></a>

[前面](#哈哈大笑)
